<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Loveboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="icon" type="image/svg+xml" href="./assets/favicon.svg" />
    <link
      href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600&family=Work+Sans:wght@300;400;500&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Naskh+Arabic:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="wwan.css" />
    <script>
      const cfg = {
        supabaseUrl: 'https://ijwxlyoxhlmlysfjzksl.supabase.co',
        supabaseAnon:
          'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlqd3hseW94aGxtbHlzZmp6a3NsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM0MTMzMTgsImV4cCI6MjA3ODk4OTMxOH0.1UUriMLsy0uplz85u5wEOAjQ5kJoxOxE-Fg6kMmSpNE',
        passY: '{{PASSCODE_YASSINE}}',
        passN: '{{PASSCODE_NIHAL}}',
        vapid: '{{VAPID_PUBLIC_KEY}}'
      };
      if (cfg.supabaseUrl && !cfg.supabaseUrl.includes('{{')) {
        window.__SUPABASE_URL__ = cfg.supabaseUrl;
      }
      if (cfg.supabaseAnon && !cfg.supabaseAnon.includes('{{')) {
        window.__SUPABASE_ANON_KEY__ = cfg.supabaseAnon;
      }
      if (cfg.passY && !cfg.passY.includes('{{')) {
        window.__PASSCODE_YASSINE__ = cfg.passY;
      }
      if (cfg.passN && !cfg.passN.includes('{{')) {
        window.__PASSCODE_NIHAL__ = cfg.passN;
      }
      if (cfg.vapid && !cfg.vapid.includes('{{')) {
        window.__VAPID_PUBLIC_KEY__ = cfg.vapid;
      }
    </script>
  </head>

  <body>
    <div id="auth-gate" class="auth-gate">
      <div class="auth-card">
        <h1>Welcome to Loveboard</h1>
        <p>Sign in with your account to enter your private space.</p>
        <form id="auth-form">
          <label for="email-input">Email</label>
          <input id="email-input" type="email" autocomplete="email" required />
          <label for="password-input">Password</label>
          <input id="password-input" type="password" autocomplete="current-password" required />
          <button type="submit" id="auth-submit" disabled>Enter Loveboard</button>
          <p id="auth-error" class="error-text"></p>
        </form>
      </div>
    </div>

    <main class="app view-panel" aria-hidden="true" id="loveboard-view">
      <nav class="view-switcher" aria-label="Switch view">
        <div class="view-switch-group">
          <button type="button" class="view-switch active" data-view="loveboard" aria-label="Loveboard">
            üè†
          </button>
          <button type="button" class="view-switch" data-view="ldapp" aria-label="Where We Are Now">
            üó∫Ô∏è
          </button>
          <div class="story-menu">
            <button
              type="button"
              class="view-switch story-menu-toggle"
              data-view="stories"
              aria-label="Stories"
              aria-haspopup="true"
              aria-expanded="false"
            >
              üìñ
            </button>
            <div class="story-menu-panel" role="menu" aria-label="Stories">
              <button type="button" class="story-menu-option" data-view="storymirror" role="menuitem">
                <span class="story-menu-icon" aria-hidden="true">‚ú®</span>
                <span class="story-menu-text">
                  <span class="story-menu-title">Create a new story</span>
                  <span class="story-menu-note">Generate a fresh future chapter</span>
                </span>
              </button>
              <button type="button" class="story-menu-option" data-view="chronicle" role="menuitem">
                <span class="story-menu-icon" aria-hidden="true">üìö</span>
                <span class="story-menu-text">
                  <span class="story-menu-title">Saved stories</span>
                  <span class="story-menu-note">Revisit your Chronicle</span>
                </span>
              </button>
            </div>
          </div>
          <button
            type="button"
            class="view-switch"
            data-view="constellation"
            aria-label="Time Capsule Constellation"
          >
            üåå
          </button>
          <button type="button" class="view-switch" data-view="valentine" aria-label="Shared Orbit">
            üíû
          </button>
        </div>
        <button class="nav-logout logout-btn" type="button" aria-label="Log out">
          ‚èª
        </button>
      </nav>
      <header class="board-header">
        <div class="board-title">
          <p class="tagline view-title" data-couple-tagline>You ‚ù§Ô∏è Partner</p>
        </div>
        <div class="avatars" aria-label="Who is here">
          <span class="avatar" id="current-user-avatar">?</span>
        </div>
      </header>

      <section class="moods" aria-live="polite">
        <div class="mood" id="user-a-mood">
          <div class="mood-meta">
            <span class="user-label" data-user-label="a">You</span>
            <span class="mood-updated" data-user="user_a" data-user-slot="a">‚Äî</span>
          </div>
          <button class="mood-btn" data-user="user_a" data-user-slot="a">
            üõ°Ô∏è<span>Protective king energy</span>
          </button>
        </div>
        <div class="mood" id="user-b-mood">
          <div class="mood-meta">
            <span class="user-label" data-user-label="b">Partner</span>
            <span class="mood-updated" data-user="user_b" data-user-slot="b">‚Äî</span>
          </div>
          <button class="mood-btn" data-user="user_b" data-user-slot="b">
            üå∏<span>Soft feminine glow</span>
          </button>
        </div>
      </section>

      <section id="board" class="board" aria-live="polite"></section>

      <button id="create-btn" class="create-btn" disabled>Create Postcard</button>
    </main>

    <section id="ldapp-view" class="ldapp-view view-panel" hidden aria-hidden="true">
      <nav class="view-switcher" aria-label="Switch view">
        <div class="view-switch-group">
          <button type="button" class="view-switch" data-view="loveboard" aria-label="Loveboard">
            üè†
          </button>
          <button type="button" class="view-switch active" data-view="ldapp" aria-label="Where We Are Now">
            üó∫Ô∏è
          </button>
          <div class="story-menu">
            <button
              type="button"
              class="view-switch story-menu-toggle"
              data-view="stories"
              aria-label="Stories"
              aria-haspopup="true"
              aria-expanded="false"
            >
              üìñ
            </button>
            <div class="story-menu-panel" role="menu" aria-label="Stories">
              <button type="button" class="story-menu-option" data-view="storymirror" role="menuitem">
                <span class="story-menu-icon" aria-hidden="true">‚ú®</span>
                <span class="story-menu-text">
                  <span class="story-menu-title">Create a new story</span>
                  <span class="story-menu-note">Generate a fresh future chapter</span>
                </span>
              </button>
              <button type="button" class="story-menu-option" data-view="chronicle" role="menuitem">
                <span class="story-menu-icon" aria-hidden="true">üìö</span>
                <span class="story-menu-text">
                  <span class="story-menu-title">Saved stories</span>
                  <span class="story-menu-note">Revisit your Chronicle</span>
                </span>
              </button>
            </div>
          </div>
          <button
            type="button"
            class="view-switch"
            data-view="constellation"
            aria-label="Time Capsule Constellation"
          >
            üåå
          </button>
          <button type="button" class="view-switch" data-view="valentine" aria-label="Shared Orbit">
            üíû
          </button>
        </div>
        <button class="nav-logout logout-btn" type="button" aria-label="Log out">
          ‚èª
        </button>
      </nav>
      <header class="wwan-bar">
        <p class="wwan-bar-title view-title">Where We Are Now</p>
      </header>

      <main class="wwan-app" aria-live="polite">
        <header class="wwan-header">
          <p class="wwan-eyebrow">Where We Are Now</p>
          <h1 class="wwan-title" data-wwan-title>Together ‚Äî Where We Are Now</h1>
          <p class="wwan-subtitle">Two hearts, two time zones, one cozy space.</p>
        </header>

        <section class="wwan-cards" aria-label="Couple status">
          <article class="wwan-profile-card" id="wwan-person-a" aria-live="polite">
            <div class="wwan-profile-header">
              <div>
                <p class="wwan-label" id="wwan-label-a" data-wwan-label="a">Your Time</p>
                <h2 class="wwan-name" id="wwan-name-a" data-wwan-name="a">You</h2>
              </div>
              <span class="wwan-badge" id="wwan-diff-badge">Loading‚Ä¶</span>
            </div>
            <div class="wwan-time" id="wwan-time-a">--:--</div>
            <p class="wwan-location" id="wwan-city-a">New York City, USA</p>
            <p class="wwan-suggestion" id="wwan-suggestion-a"></p>
            <div class="wwan-photo" aria-hidden="true">
              <img id="wwan-photo-a" alt="" />
            </div>

            <div class="wwan-weather-card" id="wwan-weather-a">
              <div class="wwan-weather-main">
                <span class="wwan-weather-emoji" id="wwan-icon-a" aria-hidden="true">‚õÖÔ∏è</span>
                <div>
                  <p class="wwan-temp" id="wwan-temp-a">--¬∞</p>
                  <p class="wwan-desc" id="wwan-desc-a">Waiting for weather‚Ä¶</p>
                </div>
              </div>
            </div>

            <div class="wwan-doing-card" id="wwan-doing-a">
              <p class="wwan-doing-title" id="wwan-doing-title-a" data-wwan-doing-title="a">What You're Probably Doing</p>
              <p class="wwan-doing-text" id="wwan-doing-text-a">Loading‚Ä¶</p>
            </div>
          </article>

          <article class="wwan-profile-card" id="wwan-person-b" aria-live="polite">
            <div class="wwan-profile-header">
              <div>
                <p class="wwan-label" id="wwan-label-b" data-wwan-label="b">Partner's Time</p>
                <h2 class="wwan-name" id="wwan-name-b" data-wwan-name="b">Partner</h2>
              </div>
              <span class="wwan-badge" id="wwan-diff-badge-secondary">Loading‚Ä¶</span>
            </div>
            <div class="wwan-time" id="wwan-time-b">--:--</div>
            <p class="wwan-location" id="wwan-city-b">Meknes, Morocco</p>
            <p class="wwan-suggestion" id="wwan-suggestion-b"></p>
            <div class="wwan-photo" aria-hidden="true">
              <img id="wwan-photo-b" alt="" />
            </div>

            <div class="wwan-weather-card" id="wwan-weather-b">
              <div class="wwan-weather-main">
                <span class="wwan-weather-emoji" id="wwan-icon-b" aria-hidden="true">‚õÖÔ∏è</span>
                <div>
                  <p class="wwan-temp" id="wwan-temp-b">--¬∞</p>
                  <p class="wwan-desc" id="wwan-desc-b">Waiting for weather‚Ä¶</p>
                </div>
              </div>
            </div>

            <div class="wwan-doing-card" id="wwan-doing-b">
              <p class="wwan-doing-title" id="wwan-doing-title-b" data-wwan-doing-title="b">What They're Probably Doing</p>
              <p class="wwan-doing-text" id="wwan-doing-text-b">Loading‚Ä¶</p>
            </div>
          </article>
        </section>

        <section class="wwan-quote-card" aria-live="polite">
          <p class="wwan-quote-eyebrow">Love Note</p>
          <p class="wwan-quote-text" id="wwan-quote-text">Loading a sweet thought‚Ä¶</p>
          <p class="wwan-quote-author" id="wwan-quote-author"></p>
        </section>

        <button class="wwan-settings-button" id="wwan-open-settings" type="button">Change my city</button>
      </main>

      <div class="wwan-modal" id="wwan-settings-modal" aria-hidden="true" role="dialog">
        <div class="wwan-modal-overlay" id="wwan-modal-overlay"></div>
        <div class="wwan-modal-panel" role="document">
          <div class="wwan-modal-header">
            <h3>Personalize</h3>
            <button class="wwan-close-button" id="wwan-close-settings" type="button">Close</button>
          </div>
          <form class="wwan-settings-form" id="wwan-settings-form">
            <label data-wwan-city-label="a">
              Your City
              <input type="text" id="wwan-input-city-a" placeholder="Your city" />
            </label>
            <label data-wwan-city-label="b">
              Partner's City
              <input type="text" id="wwan-input-city-b" placeholder="Partner city" />
            </label>
            <button class="wwan-save-button" type="submit">Save</button>
          </form>
        </div>
      </div>
    </section>

    <section id="constellation-view" class="constellation-view view-panel" hidden aria-hidden="true">
      <nav class="view-switcher" aria-label="Switch view">
        <div class="view-switch-group">
          <button type="button" class="view-switch" data-view="loveboard" aria-label="Loveboard">
            üè†
          </button>
          <button type="button" class="view-switch" data-view="ldapp" aria-label="Where We Are Now">
            üó∫Ô∏è
          </button>
          <div class="story-menu">
            <button
              type="button"
              class="view-switch story-menu-toggle"
              data-view="stories"
              aria-label="Stories"
              aria-haspopup="true"
              aria-expanded="false"
            >
              üìñ
            </button>
            <div class="story-menu-panel" role="menu" aria-label="Stories">
              <button type="button" class="story-menu-option" data-view="storymirror" role="menuitem">
                <span class="story-menu-icon" aria-hidden="true">‚ú®</span>
                <span class="story-menu-text">
                  <span class="story-menu-title">Create a new story</span>
                  <span class="story-menu-note">Generate a fresh future chapter</span>
                </span>
              </button>
              <button type="button" class="story-menu-option" data-view="chronicle" role="menuitem">
                <span class="story-menu-icon" aria-hidden="true">üìö</span>
                <span class="story-menu-text">
                  <span class="story-menu-title">Saved stories</span>
                  <span class="story-menu-note">Revisit your Chronicle</span>
                </span>
              </button>
            </div>
          </div>
          <button
            type="button"
            class="view-switch active"
            data-view="constellation"
            aria-label="Time Capsule Constellation"
          >
            üåå
          </button>
          <button type="button" class="view-switch" data-view="valentine" aria-label="Shared Orbit">
            üíû
          </button>
        </div>
        <button class="nav-logout logout-btn" type="button" aria-label="Log out">
          ‚èª
        </button>
      </nav>
      <header class="constellation-bar">
        <p class="constellation-title view-title">Time Capsule Constellation</p>
      </header>
      <main class="constellation-main">
        <div class="constellation-sky" id="constellation-sky" aria-label="Postcard constellation">
          <div class="constellation-aurora" aria-hidden="true"></div>
          <div class="constellation-whispers" aria-hidden="true">
            <span>love</span>
            <span>always</span>
            <span>near</span>
            <span>ours</span>
            <span>forever</span>
          </div>
          <canvas class="constellation-canvas" id="constellation-canvas"></canvas>
          <div class="constellation-stars" id="constellation-stars"></div>
        </div>
        <p class="constellation-hint" id="constellation-hint">Tap a star to reveal the memory.</p>
      </main>
      <div class="constellation-detail" id="constellation-detail" hidden aria-hidden="true">
        <div class="constellation-detail-inner">
          <button id="constellation-close" class="constellation-close" type="button" aria-label="Close">
            √ó
          </button>
          <p class="constellation-meta" id="constellation-meta"></p>
          <p class="constellation-message" id="constellation-message"></p>
          <div class="constellation-media" id="constellation-media"></div>
        </div>
      </div>
    </section>

    <section id="valentine-view" class="valentine-view view-panel" hidden aria-hidden="true">
      <nav class="view-switcher" aria-label="Switch view">
        <div class="view-switch-group">
          <button type="button" class="view-switch" data-view="loveboard" aria-label="Loveboard">
            üè†
          </button>
          <button type="button" class="view-switch" data-view="ldapp" aria-label="Where We Are Now">
            üó∫Ô∏è
          </button>
          <div class="story-menu">
            <button
              type="button"
              class="view-switch story-menu-toggle"
              data-view="stories"
              aria-label="Stories"
              aria-haspopup="true"
              aria-expanded="false"
            >
              üìñ
            </button>
            <div class="story-menu-panel" role="menu" aria-label="Stories">
              <button type="button" class="story-menu-option" data-view="storymirror" role="menuitem">
                <span class="story-menu-icon" aria-hidden="true">‚ú®</span>
                <span class="story-menu-text">
                  <span class="story-menu-title">Create a new story</span>
                  <span class="story-menu-note">Generate a fresh future chapter</span>
                </span>
              </button>
              <button type="button" class="story-menu-option" data-view="chronicle" role="menuitem">
                <span class="story-menu-icon" aria-hidden="true">üìö</span>
                <span class="story-menu-text">
                  <span class="story-menu-title">Saved stories</span>
                  <span class="story-menu-note">Revisit your Chronicle</span>
                </span>
              </button>
            </div>
          </div>
          <button
            type="button"
            class="view-switch"
            data-view="constellation"
            aria-label="Time Capsule Constellation"
          >
            üåå
          </button>
          <button
            type="button"
            class="view-switch active"
            data-view="valentine"
            aria-label="Shared Orbit"
          >
            üíû
          </button>
        </div>
        <button class="nav-logout logout-btn" type="button" aria-label="Log out">
          ‚èª
        </button>
      </nav>
      <main class="valentine-main">
        <section class="valentine-hero">
          <p class="valentine-eyebrow">Valentine's Week</p>
          <h1>Two orbits, one gravity.</h1>
          <p class="valentine-countdown">
            Valentine's Day is in <span id="valentine-countdown">‚Äî</span> days.
          </p>
        </section>

        <section class="valentine-orbit">
          <div class="orbit-stage" id="orbit-stage" aria-hidden="true">
            <svg class="orbit-line" id="orbit-line" viewBox="0 0 100 12" preserveAspectRatio="none" aria-hidden="true">
              <path id="orbit-line-path" d="M0 6 Q25 2 50 6 T100 6" />
            </svg>
            <div class="orbit-spark-field" id="orbit-spark-field"></div>
            <div class="orbit-orb orb-a heart" id="orbit-orb-a">
              <svg class="heart-svg" viewBox="0 0 64 58" aria-hidden="true">
                <defs>
                  <radialGradient id="heart-grad-a" cx="30%" cy="30%" r="70%">
                    <stop offset="0%" stop-color="#fff1c1" />
                    <stop offset="60%" stop-color="#f76b92" />
                    <stop offset="100%" stop-color="#f24575" />
                  </radialGradient>
                </defs>
                <path
                  fill="url(#heart-grad-a)"
                  d="M32 54s-18-12.2-26-22C-2 22 2 6.5 16 4.6 23 3.6 29 7.4 32 12.4 35 7.4 41 3.6 48 4.6 62 6.5 66 22 58 32 50 41.8 32 54 32 54z"
                />
              </svg>
              <span class="heart-label">Y</span>
            </div>
            <div class="orbit-location" id="orbit-loc-a">New York City, USA</div>
            <div class="orbit-orb orb-b heart" id="orbit-orb-b">
              <svg class="heart-svg" viewBox="0 0 64 58" aria-hidden="true">
                <defs>
                  <radialGradient id="heart-grad-b" cx="30%" cy="30%" r="70%">
                    <stop offset="0%" stop-color="#ffd2e2" />
                    <stop offset="60%" stop-color="#b38bff" />
                    <stop offset="100%" stop-color="#8a5bd6" />
                  </radialGradient>
                </defs>
                <path
                  fill="url(#heart-grad-b)"
                  d="M32 54s-18-12.2-26-22C-2 22 2 6.5 16 4.6 23 3.6 29 7.4 32 12.4 35 7.4 41 3.6 48 4.6 62 6.5 66 22 58 32 50 41.8 32 54 32 54z"
                />
              </svg>
              <span class="heart-label">N</span>
            </div>
            <div class="orbit-location" id="orbit-loc-b">Meknes, Morocco</div>
            <div class="orbit-merge" id="orbit-merge" aria-hidden="true">
              <svg class="heart-svg" viewBox="0 0 64 58" aria-hidden="true">
                <defs>
                  <radialGradient id="heart-grad-merge" cx="30%" cy="30%" r="70%">
                    <stop offset="0%" stop-color="#fff4d8" />
                    <stop offset="60%" stop-color="#f76b92" />
                    <stop offset="100%" stop-color="#f24575" />
                  </radialGradient>
                </defs>
                <path
                  fill="url(#heart-grad-merge)"
                  d="M32 54s-18-12.2-26-22C-2 22 2 6.5 16 4.6 23 3.6 29 7.4 32 12.4 35 7.4 41 3.6 48 4.6 62 6.5 66 22 58 32 50 41.8 32 54 32 54z"
                />
              </svg>
              <span>Y + N</span>
            </div>
          </div>
          <p class="orbit-status" id="orbit-status">Hold the button to pull closer.</p>
          <div class="valentine-actions">
            <button type="button" class="valentine-melt-btn" id="orbit-hold-btn">
              Hold together
            </button>
            <button type="button" class="valentine-send-btn" id="orbit-send-btn" disabled>
              Send as postcard
            </button>
          </div>
          <div class="orbit-reveal" id="orbit-reveal" hidden aria-hidden="true">
            <h2>We're Here</h2>
            <p id="orbit-message"></p>
          </div>
        </section>
      </main>
    </section>

    <section id="storymirror-view" class="storymirror-view view-panel" hidden aria-hidden="true">
      <nav class="view-switcher" aria-label="Switch view">
        <div class="view-switch-group">
          <button type="button" class="view-switch" data-view="loveboard" aria-label="Loveboard">
            üè†
          </button>
          <button type="button" class="view-switch" data-view="ldapp" aria-label="Where We Are Now">
            üó∫Ô∏è
          </button>
          <div class="story-menu">
            <button
              type="button"
              class="view-switch story-menu-toggle"
              data-view="stories"
              aria-label="Stories"
              aria-haspopup="true"
              aria-expanded="false"
            >
              üìñ
            </button>
            <div class="story-menu-panel" role="menu" aria-label="Stories">
              <button type="button" class="story-menu-option" data-view="storymirror" role="menuitem">
                <span class="story-menu-icon" aria-hidden="true">‚ú®</span>
                <span class="story-menu-text">
                  <span class="story-menu-title">Create a new story</span>
                  <span class="story-menu-note">Generate a fresh future chapter</span>
                </span>
              </button>
              <button type="button" class="story-menu-option" data-view="chronicle" role="menuitem">
                <span class="story-menu-icon" aria-hidden="true">üìö</span>
                <span class="story-menu-text">
                  <span class="story-menu-title">Saved stories</span>
                  <span class="story-menu-note">Revisit your Chronicle</span>
                </span>
              </button>
            </div>
          </div>
          <button
            type="button"
            class="view-switch"
            data-view="constellation"
            aria-label="Time Capsule Constellation"
          >
            üåå
          </button>
          <button type="button" class="view-switch" data-view="valentine" aria-label="Shared Orbit">
            üíû
          </button>
        </div>
        <button class="nav-logout logout-btn" type="button" aria-label="Log out">
          ‚èª
        </button>
      </nav>
      <header class="storymirror-bar">
        <p class="storymirror-title view-title">Story Mirror: Us, Soon</p>
      </header>
      <main class="storymirror-main">
        <header class="storymirror-hero">
          <p class="storymirror-eyebrow">Dreamy cinematic ritual</p>
          <h1>Build the future you keep whispering about.</h1>
          <p class="storymirror-subtitle">
            Move through the ritual, add your fragments, and let the story bloom into chapters and images.
          </p>
          <p class="storymirror-byline" data-story-byline>A love story</p>
        </header>

        <section class="storymirror-stepper" aria-label="Story steps">
          <button type="button" class="storymirror-step-chip active" data-step="1">Spark</button>
          <button type="button" class="storymirror-step-chip" data-step="2">Characters</button>
          <button type="button" class="storymirror-step-chip" data-step="3">Tone</button>
          <button type="button" class="storymirror-step-chip" data-step="4">Weave</button>
        </section>

        <section class="storymirror-steps">
          <article class="storymirror-step-panel active" data-step="1">
            <div class="storymirror-step-head">
              <h2>Spark the Future</h2>
              <p class="storymirror-muted">Drop vivid fragments. One line = one future moment.</p>
            </div>
            <div class="storymirror-grid">
              <div class="storymirror-input-card">
                <div class="storymirror-card-head">
                  <label for="story-fragments-y" data-story-label="a">Your moments</label>
                  <span class="storymirror-card-note">Short and specific</span>
                </div>
                <textarea
                  id="story-fragments-y"
                  rows="7"
                  placeholder="In 2028, we finally shared a sunrise in the same city‚Ä¶
The first night in our apartment felt like a vow kept‚Ä¶"
                ></textarea>
                <div class="storymirror-suggestions" data-target="story-fragments-y">
                  <button type="button" class="storymirror-suggestion" data-text="In 2028, we finally woke up in the same time zone">Same time zone</button>
                  <button type="button" class="storymirror-suggestion" data-text="Our first apartment smelled like coffee and rain">First apartment</button>
                  <button type="button" class="storymirror-suggestion" data-text="The airport reunion felt like a movie scene">Airport reunion</button>
                </div>
              </div>
              <div class="storymirror-input-card">
                <div class="storymirror-card-head">
                  <label for="story-fragments-n" data-story-label="b">Partner moments</label>
                  <span class="storymirror-card-note">Tender, lived-in, and specific</span>
                </div>
                <textarea
                  id="story-fragments-n"
                  rows="7"
                  placeholder="By 2029, our Sunday mornings were sacred‚Ä¶
Our home at night felt soft and safe‚Ä¶"
                ></textarea>
                <div class="storymirror-suggestions" data-target="story-fragments-n">
                  <button type="button" class="storymirror-suggestion" data-text="Sunday mornings meant slow tea and soft music">Sunday ritual</button>
                  <button type="button" class="storymirror-suggestion" data-text="We learned how to repair after the first big fight">Repair after conflict</button>
                  <button type="button" class="storymirror-suggestion" data-text="Home at night meant dim lights and whispered plans">Home at night</button>
                </div>
              </div>
            </div>
            <div class="storymirror-shared">
              <p class="storymirror-muted">Shared sparks</p>
              <div class="storymirror-suggestions" data-target="story-fragments-y" data-target-secondary="story-fragments-n">
                <button type="button" class="storymirror-suggestion" data-text="The day it finally felt like home, we didn‚Äôt speak for a minute">Feels like home</button>
                <button type="button" class="storymirror-suggestion" data-text="Our first anniversary in the same city was quiet and perfect">First anniversary</button>
                <button type="button" class="storymirror-suggestion" data-text="We kept one vow and broke another, but we stayed" >A vow we kept</button>
              </div>
            </div>
          </article>

          <article class="storymirror-step-panel" data-step="2">
            <h2>Give Them Character</h2>
            <p class="storymirror-muted">These details guide the voice, chemistry, and power dynamic.</p>
            <p class="storymirror-hint">Baseline profile is saved‚Äîadd what you want.</p>
            <div class="storymirror-grid">
              <div class="storymirror-input-card">
                <label for="story-profile-y" data-story-profile-label="a">Your profile</label>
                <textarea id="story-profile-y" rows="7" placeholder="Describe you..." data-story-profile-placeholder="a"></textarea>
              </div>
              <div class="storymirror-input-card">
                <label for="story-profile-n" data-story-profile-label="b">Partner profile</label>
                <textarea id="story-profile-n" rows="7" placeholder="Describe your partner..." data-story-profile-placeholder="b"></textarea>
              </div>
            </div>
          </article>

          <article class="storymirror-step-panel" data-step="3">
            <h2>Set the Tone</h2>
            <p class="storymirror-muted">Balance reality and dream, and decide how intense the chemistry gets.</p>
            <div class="storymirror-grid">
              <div class="storymirror-input-card">
                <label for="story-lens">Emotional lens</label>
                <p class="storymirror-muted" id="story-lens-label">Soft & romantic</p>
                <input id="story-lens" type="range" min="0" max="100" value="40" />
              </div>
              <div class="storymirror-input-card">
                <label for="story-fantasy">Fantasy balance</label>
                <p class="storymirror-muted" id="story-fantasy-label">Balanced</p>
                <input id="story-fantasy" type="range" min="0" max="100" value="50" />
              </div>
            </div>
            <div class="storymirror-grid">
              <div class="storymirror-input-card">
                <p class="storymirror-muted">Intimacy mode (18+)</p>
                <div class="storymirror-toggle" id="story-intimacy">
                  <label><input type="radio" name="story-intimacy" value="tender" /> Tender</label>
                  <label><input type="radio" name="story-intimacy" value="flirty" /> Flirty</label>
                  <label><input type="radio" name="story-intimacy" value="dark" checked /> Dark romance</label>
                </div>
              </div>
              <div class="storymirror-input-card">
                <p class="storymirror-muted">Perspective</p>
                <div class="storymirror-toggle">
                  <label><input type="radio" name="story-perspective" value="a" /> You</label>
                  <label><input type="radio" name="story-perspective" value="b" /> Partner</label>
                  <label><input type="radio" name="story-perspective" value="us" checked /> Us</label>
                </div>
              </div>
            </div>
          </article>

          <article class="storymirror-step-panel" data-step="4">
            <h2>Weave the Chapters</h2>
            <p class="storymirror-muted">The chapter count adapts to how much you share (up to 10).</p>
            <p class="storymirror-hint" id="story-chapter-hint">Estimated chapters: 4</p>
            <div class="storymirror-input-card">
              <label for="story-extra">Any extra details?</label>
              <textarea id="story-extra" rows="4" placeholder="Add anything you want the story to include..."></textarea>
            </div>
            <div class="storymirror-grid">
              <div class="storymirror-input-card storymirror-actions">
                <button type="button" class="storymirror-primary-btn" id="story-generate">
                  Generate full story
                </button>
                <p class="storymirror-hint" id="story-status"></p>
              </div>
            </div>
          </article>
        </section>

        <div class="storymirror-nav">
          <button type="button" class="storymirror-nav-btn" id="story-step-back">Back</button>
          <span class="storymirror-step-indicator" id="story-step-indicator">Step 1 of 4</span>
          <button type="button" class="storymirror-nav-btn primary" id="story-step-next">Next</button>
        </div>

        <section class="storymirror-output" id="story-output" aria-live="polite">
          <header class="storymirror-output-header">
            <h2>It begins here</h2>
          </header>
          <div class="storymirror-empty" id="story-empty">
            <p>Your future chapters will appear here.</p>
          </div>
          <div class="storymirror-chapters" id="story-chapters"></div>
          <div class="storymirror-footer" id="story-footer" hidden>
            <button type="button" class="storymirror-primary-btn storymirror-new-btn" id="story-new-btn">
              New story
            </button>
            <button type="button" class="storymirror-secondary-btn storymirror-save-btn" id="story-save-btn">
              Save & Share
            </button>
          </div>
        </section>
      </main>

      <div class="storymirror-ritual" id="story-ritual" hidden aria-hidden="true">
        <div class="storymirror-ritual-card">
          <p class="storymirror-eyebrow">Waiting</p>
          <h2>We are threading your future together‚Ä¶</h2>
          <p class="storymirror-muted" id="story-ritual-text">Every second is a step closer to the life you are building.</p>
          <div class="storymirror-wait-bar" aria-hidden="true">
            <span class="storymirror-wait-fill" id="story-ritual-fill"></span>
          </div>
          <p class="storymirror-ritual-hint" id="story-ritual-hint">
            The first chapter is on its way‚Ä¶ <span class="storymirror-ritual-spinner" aria-hidden="true"></span>
          </p>
        </div>
      </div>
</div>
    </section>

    <section id="chronicle-view" class="chronicle-view view-panel" hidden aria-hidden="true">
      <nav class="view-switcher" aria-label="Switch view">
        <div class="view-switch-group">
          <button type="button" class="view-switch" data-view="loveboard" aria-label="Loveboard">
            üè†
          </button>
          <button type="button" class="view-switch" data-view="ldapp" aria-label="Where We Are Now">
            üó∫Ô∏è
          </button>
          <div class="story-menu">
            <button
              type="button"
              class="view-switch story-menu-toggle"
              data-view="stories"
              aria-label="Stories"
              aria-haspopup="true"
              aria-expanded="false"
            >
              üìñ
            </button>
            <div class="story-menu-panel" role="menu" aria-label="Stories">
              <button type="button" class="story-menu-option" data-view="storymirror" role="menuitem">
                <span class="story-menu-icon" aria-hidden="true">‚ú®</span>
                <span class="story-menu-text">
                  <span class="story-menu-title">Create a new story</span>
                  <span class="story-menu-note">Generate a fresh future chapter</span>
                </span>
              </button>
              <button type="button" class="story-menu-option" data-view="chronicle" role="menuitem">
                <span class="story-menu-icon" aria-hidden="true">üìö</span>
                <span class="story-menu-text">
                  <span class="story-menu-title">Saved stories</span>
                  <span class="story-menu-note">Revisit your Chronicle</span>
                </span>
              </button>
            </div>
          </div>
          <button
            type="button"
            class="view-switch"
            data-view="constellation"
            aria-label="Time Capsule Constellation"
          >
            üåå
          </button>
          <button type="button" class="view-switch" data-view="valentine" aria-label="Shared Orbit">
            üíû
          </button>
        </div>
        <button class="nav-logout logout-btn" type="button" aria-label="Log out">
          ‚èª
        </button>
      </nav>
      <header class="chronicle-bar">
        <p class="chronicle-title view-title">Chronicle</p>
      </header>
      <main class="chronicle-main">
        <p class="chronicle-subtitle">Your shared future stories, saved and ready to relive.</p>
        <section class="chronicle-grid" id="chronicle-grid" aria-live="polite"></section>
        <p class="chronicle-empty" id="chronicle-empty">No stories saved yet.</p>
      </main>
    </section>

    <dialog id="chronicle-modal" class="modal">
      <div class="modal-content chronicle-modal">
        <header>
          <h2 id="chronicle-modal-title">Story</h2>
          <button type="button" id="chronicle-close" aria-label="Close">√ó</button>
        </header>
        <div class="chronicle-modal-body" id="chronicle-modal-body"></div>
        <button type="button" class="danger-btn" id="chronicle-delete">Delete story</button>
      </div>
    </dialog>

    <dialog id="chronicle-delete-modal" class="modal">
      <div class="modal-content logout-modal">
        <header>
          <h2>Delete this story?</h2>
        </header>
        <p class="chronicle-delete-note">This cannot be undone.</p>
        <div class="logout-actions">
          <button type="button" class="ghost" id="chronicle-delete-cancel">Keep</button>
          <button type="button" class="primary" id="chronicle-delete-confirm">Delete</button>
        </div>
      </div>
    </dialog>

<dialog id="postcard-modal" class="modal">
      <form method="dialog" class="modal-content" id="postcard-form">
        <header>
          <h2>New Postcard</h2>
          <button type="button" id="close-modal" aria-label="Close">√ó</button>
        </header>
        <div class="option-picker" role="group" aria-label="Choose postcard content">
          <button type="button" class="option-btn active" data-option="message">Note</button>
          <button type="button" class="option-btn" data-option="photo">Photo</button>
          <button type="button" class="option-btn" data-option="doodle">Doodle</button>
          <button type="button" class="option-btn" data-option="audio">Audio</button>
        </div>

        <div class="option-section message-field" data-option="message">
          <label for="message-input">Short message (150 chars)</label>
          <textarea id="message-input" maxlength="150" placeholder="Write something sweet..."></textarea>
        </div>

        <div class="option-section photo-field" data-option="photo">
          <label for="photo-input">Photo</label>
          <input id="photo-input" type="file" accept="image/*" />
        </div>

        <div class="option-section doodle-field" data-option="doodle">
          <div class="doodle-header">
            <span>Doodle</span>
            <button type="button" id="clear-doodle">Clear</button>
          </div>
          <canvas id="doodle-canvas" width="320" height="200" aria-label="Doodle"></canvas>
        </div>

        <div class="option-section audio-field" data-option="audio">
          <div class="audio-block">
            <div class="audio-header">
              <span>Audio (15s)</span>
              <button type="button" id="record-audio">Start</button>
              <span id="record-timer" class="record-timer">0:15</span>
            </div>
            <audio id="audio-preview" controls></audio>
            <p id="audio-status" class="audio-status" aria-live="polite"></p>
          </div>
        </div>

        <button type="submit" class="primary" id="send-btn" disabled>
          <span class="btn-label">Send postcard</span>
          <span class="spinner" aria-hidden="true"></span>
        </button>
        <p id="send-hint" class="send-hint" aria-live="polite"></p>
      </form>
    </dialog>

    <dialog id="logout-modal" class="modal">
      <div class="modal-content logout-modal">
        <header>
          <h2>Are you sure you want to log out?</h2>
        </header>
        <div class="logout-actions">
          <button type="button" class="ghost" id="logout-cancel">Stay</button>
          <button type="button" class="primary" id="logout-confirm">Log out</button>
        </div>
      </div>
    </dialog>

    <template id="postcard-template">
      <article class="postcard">
        <button class="delete-card" type="button" aria-label="Delete postcard">‚úï</button>
        <div class="postcard-front">
          <img class="visual" alt="Postcard visual" />
          <img class="default-visual" src="./assets/default-note.svg" alt="Default Paper" />
          <div class="front-reactions reaction-counts"></div>
        </div>
        <div class="postcard-back">
          <p class="note"></p>
          <span class="meta"></span>
          <div class="reaction-area">
            <div class="reaction-counts"></div>
            <button class="react-btn" type="button">React</button>
            <div class="reaction-picker"></div>
          </div>
          <div class="comment-section">
            <p class="comment-title">Comments</p>
            <div class="comment-list" aria-live="polite"></div>
            <form class="comment-form">
              <input
                type="text"
                name="comment"
                maxlength="280"
                placeholder="Add a sweet reply‚Ä¶"
                aria-label="Add a comment"
                autocomplete="off"
              />
              <button type="submit">Send</button>
            </form>
          </div>
        </div>
        <div class="audio-only" hidden>
          <p class="audio-label">A little voice note</p>
          <audio class="audio-player" controls></audio>
          <span class="meta"></span>
          <div class="reaction-area">
            <div class="reaction-counts"></div>
            <button class="react-btn" type="button">React</button>
            <div class="reaction-picker"></div>
          </div>
          <div class="comment-section">
            <p class="comment-title">Comments</p>
            <div class="comment-list" aria-live="polite"></div>
            <form class="comment-form">
              <input
                type="text"
                name="comment"
                maxlength="280"
                placeholder="Add a sweet reply‚Ä¶"
                aria-label="Add a comment"
                autocomplete="off"
              />
              <button type="submit">Send</button>
            </form>
          </div>
        </div>
      </article>
    </template>

    <div id="toast" class="toast" role="status" aria-live="polite"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module" src="supabase.js"></script>
    <script type="module" src="wwan.js"></script>
    <script type="module" src="script.js"></script>
  </body>
</html>
