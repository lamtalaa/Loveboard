<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Loveboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="icon" type="image/svg+xml" href="./assets/favicon.svg" />
    <link
      href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600&family=Work+Sans:wght@300;400;500&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="wwan.css" />
    <script>
      const cfg = {
        supabaseUrl: '{{SUPABASE_URL}}',
        supabaseAnon: '{{SUPABASE_ANON_KEY}}',
        passY: '{{PASSCODE_YASSINE}}',
        passN: '{{PASSCODE_NIHAL}}',
        vapid: '{{VAPID_PUBLIC_KEY}}'
      };
      if (cfg.supabaseUrl && !cfg.supabaseUrl.includes('{{')) {
        window.__SUPABASE_URL__ = cfg.supabaseUrl;
      }
      if (cfg.supabaseAnon && !cfg.supabaseAnon.includes('{{')) {
        window.__SUPABASE_ANON_KEY__ = cfg.supabaseAnon;
      }
      if (cfg.passY && !cfg.passY.includes('{{')) {
        window.__PASSCODE_YASSINE__ = cfg.passY;
      }
      if (cfg.passN && !cfg.passN.includes('{{')) {
        window.__PASSCODE_NIHAL__ = cfg.passN;
      }
      if (cfg.vapid && !cfg.vapid.includes('{{')) {
        window.__VAPID_PUBLIC_KEY__ = cfg.vapid;
      }
    </script>
  </head>

  <body>
    <div id="auth-gate" class="auth-gate">
      <div class="auth-card">
        <h1>Welcome to Loveboard</h1>
        <p>Select who you are and enter your shared passphrase.</p>
        <form id="auth-form">
          <label for="user-select">I am</label>
          <select id="user-select" required>
            <option value="">Pick one</option>
            <option value="Yassine">Yassine</option>
            <option value="Nihal">Nihal</option>
          </select>
          <label for="passcode-input">Passphrase</label>
          <input id="passcode-input" type="password" required />
          <button type="submit" id="auth-submit" disabled>Enter Loveboard</button>
          <p id="auth-error" class="error-text"></p>
        </form>
      </div>
    </div>

    <main class="app view-panel" aria-hidden="true" id="loveboard-view">
      <nav class="view-switcher" aria-label="Switch view">
        <div class="view-switch-group">
          <button type="button" class="view-switch active" data-view="loveboard" aria-label="Loveboard">
            üè†
          </button>
          <button type="button" class="view-switch" data-view="ldapp" aria-label="Where We Are Now">
            üó∫Ô∏è
          </button>
          <button
            type="button"
            class="view-switch"
            data-view="constellation"
            aria-label="Time Capsule Constellation"
          >
            üåå
          </button>
        </div>
        <button class="nav-logout logout-btn" type="button" aria-label="Log out">
          ‚èª
        </button>
      </nav>
      <header class="board-header">
        <div class="board-title">
          <p class="tagline view-title">Yassine ‚ù§Ô∏è Nihal</p>
        </div>
        <div class="avatars" aria-label="Who is here">
          <span class="avatar" id="current-user-avatar">?</span>
        </div>
      </header>

      <section class="moods" aria-live="polite">
        <div class="mood" id="yassine-mood">
          <div class="mood-meta">
            <span class="user-label">Yassine</span>
            <span class="mood-updated" data-user="Yassine">‚Äî</span>
          </div>
          <button class="mood-btn" data-user="Yassine">
            üõ°Ô∏è<span>Protective king energy</span>
          </button>
        </div>
        <div class="mood" id="nihal-mood">
          <div class="mood-meta">
            <span class="user-label">Nihal</span>
            <span class="mood-updated" data-user="Nihal">‚Äî</span>
          </div>
          <button class="mood-btn" data-user="Nihal">
            üå∏<span>Soft feminine glow</span>
          </button>
        </div>
      </section>

      <section id="board" class="board" aria-live="polite"></section>

      <button id="create-btn" class="create-btn" disabled>Create Postcard</button>
    </main>

    <section id="ldapp-view" class="ldapp-view view-panel" hidden aria-hidden="true">
      <nav class="view-switcher" aria-label="Switch view">
        <div class="view-switch-group">
          <button type="button" class="view-switch" data-view="loveboard" aria-label="Loveboard">
            üè†
          </button>
          <button type="button" class="view-switch active" data-view="ldapp" aria-label="Where We Are Now">
            üó∫Ô∏è
          </button>
          <button
            type="button"
            class="view-switch"
            data-view="constellation"
            aria-label="Time Capsule Constellation"
          >
            üåå
          </button>
        </div>
        <button class="nav-logout logout-btn" type="button" aria-label="Log out">
          ‚èª
        </button>
      </nav>
      <header class="wwan-bar">
        <p class="wwan-bar-title view-title">Where We Are Now</p>
      </header>

      <main class="wwan-app" aria-live="polite">
        <header class="wwan-header">
          <p class="wwan-eyebrow">Where We Are Now</p>
          <h1 class="wwan-title">Yassine ‚ù§Ô∏è Nihal ‚Äî Where We Are Now</h1>
          <p class="wwan-subtitle">Two hearts, two time zones, one cozy space.</p>
        </header>

        <section class="wwan-cards" aria-label="Couple status">
          <article class="wwan-profile-card" id="wwan-person-a" aria-live="polite">
            <div class="wwan-profile-header">
              <div>
                <p class="wwan-label" id="wwan-label-a">Yassine's Time</p>
                <h2 class="wwan-name" id="wwan-name-a">Yassine</h2>
              </div>
              <span class="wwan-badge" id="wwan-diff-badge">Loading‚Ä¶</span>
            </div>
            <div class="wwan-time" id="wwan-time-a">--:--</div>
            <p class="wwan-location" id="wwan-city-a">New York City, USA</p>
            <p class="wwan-suggestion" id="wwan-suggestion-a"></p>
            <div class="wwan-photo" aria-hidden="true">
              <img id="wwan-photo-a" alt="" />
            </div>

            <div class="wwan-weather-card" id="wwan-weather-a">
              <div class="wwan-weather-main">
                <span class="wwan-weather-emoji" id="wwan-icon-a" aria-hidden="true">‚õÖÔ∏è</span>
                <div>
                  <p class="wwan-temp" id="wwan-temp-a">--¬∞</p>
                  <p class="wwan-desc" id="wwan-desc-a">Waiting for weather‚Ä¶</p>
                </div>
              </div>
            </div>

            <div class="wwan-doing-card" id="wwan-doing-a">
              <p class="wwan-doing-title" id="wwan-doing-title-a">What Yassine's Probably Doing</p>
              <p class="wwan-doing-text" id="wwan-doing-text-a">Loading‚Ä¶</p>
            </div>
          </article>

          <article class="wwan-profile-card" id="wwan-person-b" aria-live="polite">
            <div class="wwan-profile-header">
              <div>
                <p class="wwan-label" id="wwan-label-b">Nihal's Time</p>
                <h2 class="wwan-name" id="wwan-name-b">Nihal</h2>
              </div>
              <span class="wwan-badge" id="wwan-diff-badge-secondary">Loading‚Ä¶</span>
            </div>
            <div class="wwan-time" id="wwan-time-b">--:--</div>
            <p class="wwan-location" id="wwan-city-b">Meknes, Morocco</p>
            <p class="wwan-suggestion" id="wwan-suggestion-b"></p>
            <div class="wwan-photo" aria-hidden="true">
              <img id="wwan-photo-b" alt="" />
            </div>

            <div class="wwan-weather-card" id="wwan-weather-b">
              <div class="wwan-weather-main">
                <span class="wwan-weather-emoji" id="wwan-icon-b" aria-hidden="true">‚õÖÔ∏è</span>
                <div>
                  <p class="wwan-temp" id="wwan-temp-b">--¬∞</p>
                  <p class="wwan-desc" id="wwan-desc-b">Waiting for weather‚Ä¶</p>
                </div>
              </div>
            </div>

            <div class="wwan-doing-card" id="wwan-doing-b">
              <p class="wwan-doing-title" id="wwan-doing-title-b">What Nihal's Probably Doing</p>
              <p class="wwan-doing-text" id="wwan-doing-text-b">Loading‚Ä¶</p>
            </div>
          </article>
        </section>

        <section class="wwan-quote-card" aria-live="polite">
          <p class="wwan-quote-eyebrow">Love Note</p>
          <p class="wwan-quote-text" id="wwan-quote-text">Loading a sweet thought‚Ä¶</p>
          <p class="wwan-quote-author" id="wwan-quote-author"></p>
        </section>

        <button class="wwan-settings-button" id="wwan-open-settings" type="button">Change my city</button>
      </main>

      <div class="wwan-modal" id="wwan-settings-modal" aria-hidden="true" role="dialog">
        <div class="wwan-modal-overlay" id="wwan-modal-overlay"></div>
        <div class="wwan-modal-panel" role="document">
          <div class="wwan-modal-header">
            <h3>Personalize</h3>
            <button class="wwan-close-button" id="wwan-close-settings" type="button">Close</button>
          </div>
          <form class="wwan-settings-form" id="wwan-settings-form">
            <label>
              Yassine's City
              <input type="text" id="wwan-input-city-a" placeholder="New York City" />
            </label>
            <label>
              Nihal's City
              <input type="text" id="wwan-input-city-b" placeholder="Meknes" />
            </label>
            <button class="wwan-save-button" type="submit">Save</button>
          </form>
        </div>
      </div>
    </section>

    <section id="constellation-view" class="constellation-view view-panel" hidden aria-hidden="true">
      <nav class="view-switcher" aria-label="Switch view">
        <div class="view-switch-group">
          <button type="button" class="view-switch" data-view="loveboard" aria-label="Loveboard">
            üè†
          </button>
          <button type="button" class="view-switch" data-view="ldapp" aria-label="Where We Are Now">
            üó∫Ô∏è
          </button>
          <button
            type="button"
            class="view-switch active"
            data-view="constellation"
            aria-label="Time Capsule Constellation"
          >
            üåå
          </button>
        </div>
        <button class="nav-logout logout-btn" type="button" aria-label="Log out">
          ‚èª
        </button>
      </nav>
      <header class="constellation-bar">
        <p class="constellation-title view-title">Time Capsule Constellation</p>
      </header>
      <main class="constellation-main">
        <div class="constellation-sky" id="constellation-sky" aria-label="Postcard constellation">
          <div class="constellation-aurora" aria-hidden="true"></div>
          <div class="constellation-whispers" aria-hidden="true">
            <span>love</span>
            <span>always</span>
            <span>near</span>
            <span>ours</span>
            <span>forever</span>
          </div>
          <canvas class="constellation-canvas" id="constellation-canvas"></canvas>
          <div class="constellation-stars" id="constellation-stars"></div>
        </div>
        <p class="constellation-hint" id="constellation-hint">Tap a star to reveal the memory.</p>
      </main>
      <div class="constellation-detail" id="constellation-detail" hidden aria-hidden="true">
        <div class="constellation-detail-inner">
          <button id="constellation-close" class="constellation-close" type="button" aria-label="Close">
            √ó
          </button>
          <p class="constellation-meta" id="constellation-meta"></p>
          <p class="constellation-message" id="constellation-message"></p>
          <div class="constellation-media" id="constellation-media"></div>
        </div>
      </div>
    </section>

    <dialog id="postcard-modal" class="modal">
      <form method="dialog" class="modal-content" id="postcard-form">
        <header>
          <h2>New Postcard</h2>
          <button type="button" id="close-modal" aria-label="Close">√ó</button>
        </header>
        <div class="option-picker" role="group" aria-label="Choose postcard content">
          <button type="button" class="option-btn active" data-option="message">Note</button>
          <button type="button" class="option-btn" data-option="photo">Photo</button>
          <button type="button" class="option-btn" data-option="doodle">Doodle</button>
          <button type="button" class="option-btn" data-option="audio">Audio</button>
        </div>

        <div class="option-section message-field" data-option="message">
          <label for="message-input">Short message (150 chars)</label>
          <textarea id="message-input" maxlength="150" placeholder="Write something sweet..."></textarea>
        </div>

        <div class="option-section photo-field" data-option="photo">
          <label for="photo-input">Photo</label>
          <input id="photo-input" type="file" accept="image/*" />
        </div>

        <div class="option-section doodle-field" data-option="doodle">
          <div class="doodle-header">
            <span>Doodle</span>
            <button type="button" id="clear-doodle">Clear</button>
          </div>
          <canvas id="doodle-canvas" width="320" height="200" aria-label="Doodle"></canvas>
        </div>

        <div class="option-section audio-field" data-option="audio">
          <div class="audio-block">
            <div class="audio-header">
              <span>Audio (15s)</span>
              <button type="button" id="record-audio">Start</button>
              <span id="record-timer" class="record-timer">0:15</span>
            </div>
            <audio id="audio-preview" controls></audio>
            <p id="audio-status" class="audio-status" aria-live="polite"></p>
          </div>
        </div>

        <button type="submit" class="primary" id="send-btn" disabled>
          <span class="btn-label">Send postcard</span>
          <span class="spinner" aria-hidden="true"></span>
        </button>
        <p id="send-hint" class="send-hint" aria-live="polite"></p>
      </form>
    </dialog>

    <dialog id="logout-modal" class="modal">
      <div class="modal-content logout-modal">
        <header>
          <h2>Are you sure you want to log out?</h2>
        </header>
        <div class="logout-actions">
          <button type="button" class="ghost" id="logout-cancel">Stay</button>
          <button type="button" class="primary" id="logout-confirm">Log out</button>
        </div>
      </div>
    </dialog>

    <template id="postcard-template">
      <article class="postcard">
        <button class="delete-card" type="button" aria-label="Delete postcard">‚úï</button>
        <div class="postcard-front">
          <img class="visual" alt="Postcard visual" />
          <img class="default-visual" src="./assets/default-note.svg" alt="Default Paper" />
          <div class="front-reactions reaction-counts"></div>
        </div>
        <div class="postcard-back">
          <p class="note"></p>
          <span class="meta"></span>
          <div class="reaction-area">
            <div class="reaction-counts"></div>
            <button class="react-btn" type="button">React</button>
            <div class="reaction-picker"></div>
          </div>
          <div class="comment-section">
            <p class="comment-title">Comments</p>
            <div class="comment-list" aria-live="polite"></div>
            <form class="comment-form">
              <input
                type="text"
                name="comment"
                maxlength="280"
                placeholder="Add a sweet reply‚Ä¶"
                aria-label="Add a comment"
                autocomplete="off"
              />
              <button type="submit">Send</button>
            </form>
          </div>
        </div>
        <div class="audio-only" hidden>
          <p class="audio-label">A little voice note</p>
          <audio class="audio-player" controls></audio>
          <span class="meta"></span>
          <div class="reaction-area">
            <div class="reaction-counts"></div>
            <button class="react-btn" type="button">React</button>
            <div class="reaction-picker"></div>
          </div>
          <div class="comment-section">
            <p class="comment-title">Comments</p>
            <div class="comment-list" aria-live="polite"></div>
            <form class="comment-form">
              <input
                type="text"
                name="comment"
                maxlength="280"
                placeholder="Add a sweet reply‚Ä¶"
                aria-label="Add a comment"
                autocomplete="off"
              />
              <button type="submit">Send</button>
            </form>
          </div>
        </div>
      </article>
    </template>

    <div id="toast" class="toast" role="status" aria-live="polite"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module" src="supabase.js"></script>
    <script type="module" src="wwan.js"></script>
    <script type="module" src="script.js"></script>
  </body>
</html>
